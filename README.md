# QuickStart
## Guides
Merchants need to contact[dizpay](https://www.dizpay.com/en/contact)toApply for an account and get app_key and app_id
。
BASE_URL:http://api.cryptopay.icaicloud.com, All payment interfaces use post。
![Docking process](https://github.com/DizPay/DizPay/static/img/process.png)
## Signature Rule
The POST parameter increases app_id, app_key and is arranged in alphabetical order as k1=v1&k2=v2 ... string, 
and the md5 value (lowercase) of the string is the signature. Note that Chinese needs utf8 encoding!例 POST 参数：
```json
{
  "number": "8eb9bc53-75ea  4142-8a91-af89d2246379",
  "address": "1DLVkXuZrSVhw9Ymm72csp99A8wufe76F8",
  "to_address": "1DLVkXuZrSVhw9Ymm72csp99A8wufe76F8",
  "amount": "1",
  "fee": "0.002"
}
```
Generate list：
`address=1DLVkXuZrSVhw9Ymm72csp99A8wufe76F8&amount=1&app_id=dp9vC69mdA3QG2VPRe&app_key=e145d582c31928ca103d262b200e882d&fee=0.002&number=8eb9bc53-75ea-4142-8a91-af89d2246379&to_address=1DLVkXuZrSVhw9Ymm72csp99A8wufe76F8`

Calculate md5 value (lowercase)
`f433acfea90730724f8261fdb0d502e1`（signature）
Final POST parameters:
```json
{
  "app_id":"dp9vC69mdA3QG2VPRe",
  "signature":"f433acfea90730724f8261fdb0d502e1",
  "number": "8eb9bc53-75ea-4142-8a91-af89d2246379",
  "address": "1DLVkXuZrSVhw9Ymm72csp99A8wufe76F8",
  "to_address": "1DLVkXuZrSVhw9Ymm72csp99A8wufe76F8",
  "amount": "1",
  "fee": "0.002"
}
```

## Python Instance
### Create Signature SDK
```python
# -*- coding: utf-8 -*-
import hashlib
import requests


class ApiError(Exception):
    def __init__(self, http_status_code, code, message):
        self.http_status_code = http_status_code
        self.code = code
        self.message = message


class Api(object):
    def __init__(self, app_id, app_key):
        self.app_id = app_id
        self.app_key = app_key

    def post(self, url, data):
        data['app_id'] = self.app_id
        data['app_key'] = self.app_key
        items = data.items()
        kv_pair_list = []
        for k, v in items:
            kv_pair_list.append('{}={}'.format(k, v.encode('utf-8') if hasattr(v, 'encode') else v))
        kv_pair_list.sort()
        signature = hashlib.md5('&'.join(kv_pair_list)).hexdigest()
        data.pop('app_key')
        data['signature'] = signature
        r = requests.post(url, json=data, timeout=5)
        if r.status_code == requests.codes.ok:
            if r.encoding is None or r.encoding == 'ISO-8859-1':
                r.encoding = 'UTF-8'
            return r.json()
        elif r.status_code == 400:
            error_data = r.json()
            raise ApiError(r.status_code, error_data['code'], error_data['message'])
        else:
            raise ApiError(r.status_code, -1, {})


merchantApi = Api(YOUR_APP_ID, YOUR_APP_KEY)
```
### Deposit
Replenishment is used to complete a payment, payment scenario: the user first recharges his wallet, 
then uses his own balance to purchase the goods and complete a transaction. Advantages: Payment is efficient and fast, 
and users can get feedback in time. Disadvantages: Users must first recharge to merchants.
#### 1.Create User Wallet
* Assign digital currency wallet addresses to your users after they sign up or log in.
* The digital currency wallet can be configured for each user via the interface `/member/create_wallet`.
* `currency_list`: you can pass in the list of currencies you want to support, such as `"BTC, ETH"`, 
which will create `BTC LTC DOGE DASH BTG BCH USDT ETH by default.
```python
url = '{}/member/create_wallet'.format(BASE_URL)
wallet_list = merchant_api.post(url, {'currency_list': None})
```
* Then save the `wallet_list` to the current user. (At this point, the wallet has been created for the user).
* After creating a wallet for the member, guide the member to deposit.
#### 2.Create Order
* Order can be created via the interface `/member/create_transaction_order`.
* `number`: Generated by the merchant itself (globally unique), and the order number can be generated by something like `uuid.uuid4()`.
* `address`: Current user's wallet address.
* `to_address`: Transaction target member address (if not passed, the default payment to the merchant)
* `fee`: If the merchant wants to charge the user's handling fee, it can be implemented through this field. For example, 
setting `{"amount": "100", "fee": "1"}` will deduct user 101.
* `extra`: extra information.
```python
import uuid


url = '{}/member/create_transaction_order'.format(BASE_URL)
params = {
    'number': '8eb9bc53-75ea-4142-8a91-af89d2246371',
    'address': '1sLahdrYh4YAFAdrHVUTAuCw8RzDFmn7M',
    'amount': '1',
    'fee': '0',
     'extra': ''
}
res = merchant_api.post(url, params)
```
* The user successfully created an order.
#### 3.Payment Order
* Pay the order via the interface `/member/pay_order`.
* `number`: The order number when you created.
```python
import uuid


url = '{}/member/pay_order'.format(base_url)
params = {
    'number': '8eb9bc53-75ea-4142-8a91-af89d2246371'
}
result = merchant_api.post(url, params)
```
* We completed a transaction for the user
#### Paying Orders Multiple Times
For some special business scenarios, we offer multiple payment orders. For example, 
create a red envelope (equivalent to an order), and then randomly assigned to n people, 
then pay multiple times, pay each person. If you prefer, you can use some other payment scenarios.
(1)Create A Multiple Payment Order.
* Interface：`/member/create_multi_pay_order`.
* `number`: Merchant background generation（Globally unique），The order number can be generated by something like uuid.uuid4().
* `address`: Current user's wallet address.
* `amount`: Payment amount(total amount of multiple payment orders).
* `fee`: If the merchant wants to charge the user's handling fee, it can be implemented through this field.
 For example, setting {"amount": "100", "fee": "1"} will deduct user 101.
* `extra`: extra information.
```python
import uuid


url = '{}/member/create_multi_pay_order'.format(BASE_URL)
params = {
    'number': 'c80f5338-ee42-433b-9b30-29ea1fe05af0',
    'address': '1sLahdrYh4YAFAdrHVUTAuCw8RzDFmn7M',
    'amount': '1',
    'fee': '0',
    'extra': ''
}
res = merchant_api.post(url, params)
```
* So we successfully created a multiple payment order.
(2)Pay Multiple Orders
* Interface： `/member/pay_multi_pay_order`
* `multi_pay_order_number`: The order number when you created.
* `order_number`: The randomly generated order number is globally unique. When an order needs to be paid multiple times, 
it needs to be distinguished according to `order_number`, for example, create a red envelope (equivalent to an order), 
and then randomly assign it to n people (then everyone Equivalent to an order number is `order_number`).
* `to_address`: Target member address for each payment.
* `amount`: Amount paid per time.
* `fee`: If the merchant wants to charge the user's handling fee, it can be implemented through this field.
 For example, setting {"amount": "100", "fee": "1"} will deduct user 101.
* `extra`: extra information.

```python
import uuid


url = '{}/member/pay_order'.format(base_url)
params = {
    'multi_pay_order_number': 'c80f5338-ee42-433b-9b30-29ea1fe05af0',
    'order_number': 'e131dd2f-9f0f-4bf0-bc69-b1895b6b2f84',
    'to_address': '1sLahdrYh4YAFAdrHVUTAuCw8RzDFmn7M',
    'amount': '0.5',
    'fee': 0,
    'extra': ''
}
result = merchant_api.post(url, params)
```
* You can pay this order(`e131dd2f-9f0f-4bf0-bc69-b1895b6b2f84`) multiple times through this interface.

### Accept Payment
The payment is done by means of payment. Advantages: Users can store the digital currency anywhere and transfer to the merchant when they need to pay. 
Disadvantages: Merchants do not control the amount they want to collect; and due to the real-time limitation of digital currency, users cannot get feedback on this payment in time (payment success or failure).
#### Complete payment by creating a payment order (fast payment)
* Create a payment order via the api interface `/member/create_charge_order`.
* `number`: Order number (globally unique)
* `amount`: Amount of legal currency (you can set the type of legal currency, such as: USD, CNY) 
* `payments`: "BTC=0.001; ETH=0.12" digital currency payment information, 
semicolon division (digital currency is exchanged according to the amount of legal currency in real time)
* `extra`: extra information.
```python
import uuid


url = '{}/member/create_charge_order'.format(base_url)
params = {
    'number': '317bd7f8-997c-4e66-a2e8-200ab5527abc',
    'amount': '10',
    'payments': 'BTC=0.001;ETH=0.12',
    'extra': ''
}
result = merchant_api.post(url, params)
```
* After creating the order, you will get a payment information (see the api document for details), which is mainly a collection address, 
and then the user will pay this address to complete the payment. Pay the QR code generation rule:{base_url}/currency_address_qr_code/{address}.
* Check the order status via the interface `/member/query_charge_order`.
* The incoming order number `number` is checked according to the result of the `status` to check the order status: # 1 Payment 2 Complete 4 Withdrawn.
```python
url = '{}//member/query_charge_order'.format(base_url)
result = merchant_api.post(url, {'number': '317bd7f8-997c-4e66-a2e8-200ab5527abc'})
```

# Demo
You can find the demo [on the website](https://www.dizpay.com/en/demo)

# Documentation
You can find the dizpay api documentation [on the website](https://www.dizpay.com/en/developer)
